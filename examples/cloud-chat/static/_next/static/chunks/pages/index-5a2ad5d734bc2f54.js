(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[405],{8581:function(e,n,t){(window.__NEXT_P=window.__NEXT_P||[]).push(["/",function(){return t(4496)}])},4496:function(e,n,t){"use strict";t.r(n),t.d(n,{default:function(){return Te}});var r=t(5893),s=t(6277),a=t(7294),o=t(4051),i=t.n(o),c=t(5988),l=t.n(c),u=t(5874),d=new(t(8845).y),f=t(3454),h=("localhost"===window.location.hostname?"".concat(window.location.protocol,"//").concat(window.location.hostname,":").concat(window.location.port):"".concat(window.location.protocol,"//").concat(window.location.hostname),"localhost"===window.location.hostname?f.env.NEXT_PUBLIC_API_URL:"".concat(window.location.protocol,"//").concat(window.location.hostname));function v(e,n,t,r,s,a,o){try{var i=e[a](o),c=i.value}catch(l){return void t(l)}i.done?n(c):Promise.resolve(c).then(r,s)}function p(e){return function(){var n=this,t=arguments;return new Promise((function(r,s){var a=e.apply(n,t);function o(e){v(a,r,s,o,i,"next",e)}function i(e){v(a,r,s,o,i,"throw",e)}o(void 0)}))}}function m(e,n){for(var t=0;t<n.length;t++){var r=n[t];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function x(e,n,t){return n in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}var g=function(){function e(){!function(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")}(this,e),x(this,"user",void 0),x(this,"isAuthenticated",!1),x(this,"error",void 0),x(this,"position",void 0),x(this,"systemWarning",void 0)}var n,t,r;return n=e,(t=[{key:"login",value:function(e){var n=e.username,t=e.password,r=this;return p(i().mark((function e(){var s,a,o,c,l,u;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,fetch("".concat(h,"/login"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({username:n,password:t})});case 2:return s=e.sent,e.next=5,s.json();case 5:a=e.sent,o=a.token,c=a.user,l=a.message,u=a.systemWarning,o&&(r.token=o,r.user=c,r.isAuthenticated=!0,r.watchPosition()),r.error=l,r.systemWarning=u;case 13:case"end":return e.stop()}}),e)})))()}},{key:"register",value:function(e){var n=e.username,t=e.password,r=e.name,s=this;return p(i().mark((function e(){var a,o,c,l,u,d;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,fetch("".concat(h,"/register"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({username:n,password:t,name:r})});case 2:return a=e.sent,e.next=5,a.json();case 5:o=e.sent,c=o.token,l=o.user,u=o.message,d=o.systemWarning,c&&(s.token=c,s.user=l,s.isAuthenticated=!0,s.watchPosition()),s.error=u,s.systemWarning=d;case 13:case"end":return e.stop()}}),e)})))()}},{key:"logout",value:function(){var e=this;return p(i().mark((function n(){return i().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:e.token=void 0,e.user=void 0,e.isAuthenticated=!1,e.error=void 0;case 4:case"end":return n.stop()}}),n)})))()}},{key:"getToken",value:function(){return this.token}},{key:"updatePosition",value:function(){var e=this;return p(i().mark((function n(){var t;return i().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,fetch("".concat(h,"/me"),{method:"PUT",headers:{Authorization:"Bearer ".concat(e.token),"Content-Type":"application/json"},body:JSON.stringify(e.position)});case 2:return t=n.sent,n.next=5,t.json();case 5:e.user=n.sent;case 6:case"end":return n.stop()}}),n)})))()}},{key:"watchPosition",value:function(){!1 in navigator?console.warn("geolocation not supported"):navigator.geolocation.watchPosition(this.geolocationSuccess.bind(this),this.geolocationError.bind(this))}},{key:"geolocationSuccess",value:function(e){var n=e.coords;this.position={lat:n.latitude,lon:n.longitude},this.updatePosition()}},{key:"geolocationError",value:function(e){console.log("geolocationError",e)}}])&&m(n.prototype,t),r&&m(n,r),e}(),b=(0,u.sj)(new g),j=t(6486);function y(e,n,t,r,s,a,o){try{var i=e[a](o),c=i.value}catch(l){return void t(l)}i.done?n(c):Promise.resolve(c).then(r,s)}function w(e){return function(){var n=this,t=arguments;return new Promise((function(r,s){var a=e.apply(n,t);function o(e){y(a,r,s,o,i,"next",e)}function i(e){y(a,r,s,o,i,"throw",e)}o(void 0)}))}}function k(e,n){for(var t=0;t<n.length;t++){var r=n[t];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function C(e,n,t){return n in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}var N=function(){function e(){!function(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")}(this,e),C(this,"items",[]),C(this,"bounds",void 0),C(this,"center",void 0),C(this,"radius",void 0),C(this,"ready",!1),C(this,"userCache",new Map),C(this,"fetch",(0,j.throttle)(this.fetchInternal,1e3))}var n,t,r;return n=e,(t=[{key:"setSearchBounds",value:function(e){this.bounds=e,this.fetch()}},{key:"setSearchRadius",value:function(e,n){this.center=e,this.radius=n,this.bounds=void 0,this.fetch()}},{key:"fetchInternal",value:function(){var e=this;return w(i().mark((function n(){var t,r,s,a,o;return i().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=3,b.getToken();case 3:return r=n.sent,s=new URL("".concat(h,"/users")),(null===(t=e.bounds)||void 0===t?void 0:t.sw)&&(s.searchParams.append("sw.lat",e.bounds.sw.lat),s.searchParams.append("sw.lon",e.bounds.sw.lon),s.searchParams.append("ne.lat",e.bounds.ne.lat),s.searchParams.append("ne.lon",e.bounds.ne.lon)),e.center&&(s.searchParams.append("center.lat",e.center.lat),s.searchParams.append("center.lon",e.center.lon),s.searchParams.append("radius",e.radius)),n.next=9,fetch(s,{headers:{Authorization:"Bearer ".concat(r)}});case 9:return a=n.sent,n.next=12,a.json();case 12:o=n.sent.items,e.items=(o||[]).filter((function(e){return e.value.id!==b.user.id})),e.ready=!0;case 15:case"end":return n.stop()}}),n)})))()}},{key:"getUser",value:function(e){var n=this;return w(i().mark((function t(){var r,s,a;return i().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(n.userCache.get(e)){t.next=11;break}return t.next=3,b.getToken();case 3:return r=t.sent,t.next=6,fetch("".concat(h,"/users/").concat(e),{headers:{Authorization:"Bearer ".concat(r)}});case 6:return s=t.sent,t.next=9,s.json();case 9:a=t.sent,n.userCache.set(e,a);case 11:return t.abrupt("return",n.userCache.get(e));case 12:case"end":return t.stop()}}),t)})))()}}])&&k(n.prototype,t),r&&k(n,r),e}(),I=(0,u.sj)(new N);function P(e,n){(null==n||n>e.length)&&(n=e.length);for(var t=0,r=new Array(n);t<n;t++)r[t]=e[t];return r}function T(e,n,t,r,s,a,o){try{var i=e[a](o),c=i.value}catch(l){return void t(l)}i.done?n(c):Promise.resolve(c).then(r,s)}function S(e){return function(){var n=this,t=arguments;return new Promise((function(r,s){var a=e.apply(n,t);function o(e){T(a,r,s,o,i,"next",e)}function i(e){T(a,r,s,o,i,"throw",e)}o(void 0)}))}}function O(e,n){for(var t=0;t<n.length;t++){var r=n[t];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function U(e,n,t){return n in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}function Z(e,n){return function(e){if(Array.isArray(e))return e}(e)||function(e,n){var t=null==e?null:"undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=t){var r,s,a=[],o=!0,i=!1;try{for(t=t.call(e);!(o=(r=t.next()).done)&&(a.push(r.value),!n||a.length!==n);o=!0);}catch(c){i=!0,s=c}finally{try{o||null==t.return||t.return()}finally{if(i)throw s}}return a}}(e,n)||R(e,n)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function A(e){return function(e){if(Array.isArray(e))return P(e)}(e)||function(e){if("undefined"!==typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||R(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function R(e,n){if(e){if("string"===typeof e)return P(e,n);var t=Object.prototype.toString.call(e).slice(8,-1);return"Object"===t&&e.constructor&&(t=e.constructor.name),"Map"===t||"Set"===t?Array.from(t):"Arguments"===t||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t)?P(e,n):void 0}}var E=function(){function e(){!function(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")}(this,e),U(this,"messages",[]),U(this,"conversations",[]),U(this,"typing",!1),U(this,"message",""),U(this,"selectedConversation",void 0),U(this,"selectedConversationId",void 0),U(this,"selectedUserId",void 0),U(this,"typingConversationId",void 0),U(this,"typingTimeout",void 0)}var n,t,r;return n=e,(t=[{key:"selectConversation",value:function(e){var n=e.convId;n!==this.selectedConversationId&&(this.messages=[],this.selectedConversationId=n,this.selectedConversation=this.conversations.find((function(e){return e.value.convId===n})),this.selectedUserId=void 0,this.selectedUserName=void 0,this.conversations=this.conversations.filter((function(e){return"new-conversation"!==e.value.convId})),this.fetch()),d.emit("conversation.selected",[this.selectedConversationId])}},{key:"findUserConversation",value:function(e){var n=this;return S(i().mark((function t(){return i().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",n.conversations.find((function(n){var t;return null===(t=n.value.userIds)||void 0===t?void 0:t.includes(e)})));case 1:case"end":return t.stop()}}),t)})))()}},{key:"selectUser",value:function(e){var n=e.id,t=e.name,r=this;return S(i().mark((function e(){var s,a;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,r.findUserConversation(n);case 2:if(!(s=e.sent)){e.next=6;break}return r.selectConversation(s.value),e.abrupt("return");case 6:r.selectedConversationId="new-conversation",r.selectedConversation={key:"new-conversation",value:{title:t,convId:"new-conversation",last:"New conversation"}},r.selectedUserId=n,r.selectedUserName=t,r.messages=[],a=r.conversations.filter((function(e){return"new-conversation"!==e.value.convId})),r.conversations=[r.selectedConversation].concat(A(a)),d.emit("conversation.selected",[r.selectedConversationId]);case 14:case"end":return e.stop()}}),e)})))()}},{key:"start",value:function(){var e=this;return this.interval||(this.interval=setInterval(this.fetch.bind(this),5e3),this.fetch()),function(){e.stop()}}},{key:"stop",value:function(){this.interval&&(clearInterval(this.interval),this.interval=void 0)}},{key:"updateTyping",value:function(){var e=this;return S(i().mark((function n(){return i().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(e.typingTimeout&&clearTimeout(e.typingTimeout),!e.typingConversationId||e.typingConversationId===e.selectedConversationId){n.next=5;break}return n.next=4,e.putTypingState(e.typingConversationId,!1);case 4:e.typingConversationId=void 0;case 5:if(!e.selectedConversationId||"new-conversation"===e.selectedConversationId||e.typingConversationId){n.next=9;break}return e.typingConversationId=e.selectedConversationId,n.next=9,e.putTypingState(e.typingConversationId,!0);case 9:e.typingTimeout=setTimeout(e.clearTyping.bind(e),5e3);case 10:case"end":return n.stop()}}),n)})))()}},{key:"clearTyping",value:function(){var e=this;return S(i().mark((function n(){return i().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,e.putTypingState(e.typingConversationId,!1);case 2:e.typingConversationId=void 0;case 3:case"end":return n.stop()}}),n)})))()}},{key:"putTypingState",value:function(e,n){return S(i().mark((function t(){var r;return i().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,b.getToken();case 2:return r=t.sent,t.next=5,fetch("".concat(h,"/typing"),{method:"PUT",headers:{Authorization:"Bearer ".concat(r),"Content-Type":"application/json"},body:JSON.stringify({convId:e,typing:n})});case 5:case"end":return t.stop()}}),t)})))()}},{key:"getConversations",value:function(){return S(i().mark((function e(){var n,t;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,b.getToken();case 2:return n=e.sent,e.next=5,fetch("".concat(h,"/conversations"),{headers:{Authorization:"Bearer ".concat(n)}});case 5:return t=e.sent,e.abrupt("return",t.json());case 7:case"end":return e.stop()}}),e)})))()}},{key:"getMessages",value:function(e){return S(i().mark((function n(){var t,r,s;return i().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(e&&"new-conversation"!==e){n.next=2;break}return n.abrupt("return",{items:[]});case 2:return n.next=4,b.getToken();case 4:return t=n.sent,(r=new URL("".concat(h,"/messages"))).searchParams.append("convId",e),n.next=9,fetch(r,{headers:{Authorization:"Bearer ".concat(t)}});case 9:return s=n.sent,n.abrupt("return",s.json());case 11:case"end":return n.stop()}}),n)})))()}},{key:"fetch",value:function(){var e=this;return S(i().mark((function n(){var t,r,s,a;return i().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return(t=e.selectedConversationId)||(e.messages=[]),n.t0=Z,n.next=5,Promise.all([e.getMessages(t),e.getConversations()]);case 5:if(n.t1=n.sent,r=(0,n.t0)(n.t1,2),s=r[0],a=r[1],e.messages=s.items,e.conversations=a.items,e.selectedConversation=e.selectedConversationId&&e.conversations.find((function(n){return n.value.convId===e.selectedConversationId})),e.selectedUserId&&(e.selectedConversationId="new-conversation",e.selectedConversation={key:"new-conversation",value:{title:e.selectedUserName,convId:"new-conversation",last:"New conversation"}},e.conversations=[e.selectedConversation].concat(A(e.conversations))),e.selectedUserId||e.selectedConversationId||!e.conversations[0]){n.next=17;break}return e.selectedConversationId=e.conversations[0].value.convId,n.next=17,e.fetch();case 17:case"end":return n.stop()}}),n)})))()}},{key:"createConversation",value:function(){var e=this;return S(i().mark((function n(){var t,r,s;return i().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,b.getToken();case 2:return t=n.sent,n.next=5,fetch("".concat(h,"/conversations"),{method:"POST",headers:{Authorization:"Bearer ".concat(t),"Content-Type":"application/json"},body:JSON.stringify({userIds:[e.selectedUserId,b.user.id]})});case 5:return r=n.sent,n.next=8,r.json();case 8:return s=n.sent.convId,n.abrupt("return",s);case 10:case"end":return n.stop()}}),n)})))()}},{key:"send",value:function(){var e=this;return S(i().mark((function n(){var t,r;return i().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(e.message){n.next=2;break}return n.abrupt("return");case 2:if(t=e.message,e.message="","new-conversation"!==e.selectedConversationId){n.next=8;break}return n.next=7,e.createConversation();case 7:e.selectedConversationId=n.sent;case 8:return n.next=10,b.getToken();case 10:return r=n.sent,n.next=13,fetch("".concat(h,"/messages"),{method:"POST",headers:{Authorization:"Bearer ".concat(r),"Content-Type":"application/json"},body:JSON.stringify({convId:e.selectedConversationId,text:t})});case 13:return e.selectedUserId=void 0,n.next=16,Promise.all([e.fetch(),e.clearTyping()]);case 16:case"end":return n.stop()}}),n)})))()}},{key:"getUsers",value:function(e){return S(i().mark((function n(){return i().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,Promise.all(e.map((function(e){return I.getUser(e)})));case 2:return n.abrupt("return",n.sent);case 3:case"end":return n.stop()}}),n)})))()}}])&&O(n.prototype,t),r&&O(n,r),e}(),z=(0,u.sj)(new E);function B(){return(0,r.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"6",viewBox:"0 0 24 6",children:(0,r.jsxs)("g",{className:"jsx-4e1e254cc6914aef",children:[(0,r.jsx)(l(),{id:"4e1e254cc6914aef",children:".dot.jsx-4e1e254cc6914aef{fill:rgba(0, 0, 0, 0.7);\ntransform-origin:50% 50%;\n-webkit-animation:ball-beat 1.1s 0s infinite cubic-bezier(0.445, 0.05, 0.55, 0.95);\nanimation:ball-beat 1.1s 0s infinite cubic-bezier(0.445, 0.05, 0.55, 0.95)}\n.dot.jsx-4e1e254cc6914aef:nth-child(2){animation-delay:0.3s!important}\n.dot.jsx-4e1e254cc6914aef:nth-child(3){animation-delay:0.6s!important}\n@keyframes ball-beat {0% {opacity:0.7}33.33% {opacity:0.55}66.67% {opacity:0.4}100% {opacity:1}}"}),(0,r.jsx)("circle",{cx:"3",cy:"3",r:"3",className:"jsx-4e1e254cc6914aef dot"}),(0,r.jsx)("circle",{cx:"12",cy:"3",r:"3",className:"jsx-4e1e254cc6914aef dot"}),(0,r.jsx)("circle",{cx:"21",cy:"3",r:"3",className:"jsx-4e1e254cc6914aef dot"})]})})}function _(){return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(l(),{id:"4711a5a2fce013ff",children:'p.jsx-4711a5a2fce013ff{max-width:66%;\nword-wrap:break-word;\nline-height:24px;\nposition:relative;\npadding:10px 20px;\nborder-radius:25px;\nmargin:5px}\np.jsx-4711a5a2fce013ff:before{width:20px;\ncontent:"";\nposition:absolute;\nbottom:0;\nheight:25px}\np.jsx-4711a5a2fce013ff:after{width:26px;\ncontent:"";\nposition:absolute;\nbottom:0;\nheight:25px}\n.receive.jsx-4711a5a2fce013ff:before{left:-7px;\nborder-bottom-right-radius:16px 14px;\nbackground-color:#f8f9fa}\n.receive.jsx-4711a5a2fce013ff:after{left:-26px;\nbackground-color:#fff;\nborder-bottom-right-radius:10px}'}),(0,r.jsx)("li",{className:"jsx-4711a5a2fce013ff d-flex align-items-center mb-2",children:(0,r.jsx)("p",{className:"jsx-4711a5a2fce013ff bg-light receive",children:(0,r.jsx)(B,{})})})]})}function K(e,n,t,r,s,a,o){try{var i=e[a](o),c=i.value}catch(l){return void t(l)}i.done?n(c):Promise.resolve(c).then(r,s)}function F(e){var n=e.typing,t=(0,s.RK)(z).message,o=(0,a.useRef)(),c=(0,a.useCallback)((function(e){var n;(n=i().mark((function n(){return i().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:e.preventDefault(),e.stopPropagation(),z.send();case 3:case"end":return n.stop()}}),n)})),function(){var e=this,t=arguments;return new Promise((function(r,s){var a=n.apply(e,t);function o(e){K(a,r,s,o,i,"next",e)}function i(e){K(a,r,s,o,i,"throw",e)}o(void 0)}))})()}),[]),u=(0,a.useCallback)((function(){setTimeout((function(){return o.current.focus()}),100)}),[]),f=(0,a.useCallback)((function(e){z.message=e.target.value,z.updateTyping()}),[]);return(0,a.useEffect)((function(){return d.on("conversation.selected",u),function(){d.off("conversation.selected",u)}}),[u]),(0,r.jsxs)("form",{onSubmit:c,className:"jsx-9f5f4cf7656f5fc6 position-absolute bottom-0 w-100",children:[(0,r.jsx)(l(),{id:"9f5f4cf7656f5fc6",children:"*.jsx-9f5f4cf7656f5fc6{background-color:rgba(255, 255, 255, 0.6)}"}),(0,r.jsxs)("div",{className:"jsx-9f5f4cf7656f5fc6 p-2",children:[n&&(0,r.jsx)(_,{}),(0,r.jsx)("input",{ref:o,type:"text",value:t,placeholder:"Message",onChange:f,className:"jsx-9f5f4cf7656f5fc6 text-muted rounded-pill form-control"})]})]})}var L=t(6010);function M(e){var n=e.message,t=e.sent;return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(l(),{id:"80b28c207c94f510",children:'p.jsx-80b28c207c94f510{max-width:66%;\nword-wrap:break-word;\nline-height:24px;\nposition:relative;\npadding:10px 20px;\nborder-radius:25px;\nmargin:5px}\np.jsx-80b28c207c94f510:before{width:20px;\ncontent:"";\nposition:absolute;\nbottom:0;\nheight:25px}\np.jsx-80b28c207c94f510:after{width:26px;\ncontent:"";\nposition:absolute;\nbottom:0;\nheight:25px}\n.send.jsx-80b28c207c94f510:before{right:-7px;\nborder-bottom-left-radius:16px 14px;\nbackground-color:#0d6efd}\n.send.jsx-80b28c207c94f510:after{right:-26px;\nborder-bottom-left-radius:10px;\nbackground-color:#fff}\n.receive.jsx-80b28c207c94f510:before{left:-7px;\nborder-bottom-right-radius:16px 14px;\nbackground-color:#f8f9fa}\n.receive.jsx-80b28c207c94f510:after{left:-26px;\nbackground-color:#fff;\nborder-bottom-right-radius:10px}'}),(0,r.jsx)("li",{className:"jsx-80b28c207c94f510 "+((0,L.Z)("d-flex align-items-center overflow-hidden",t&&"flex-row-reverse")||""),children:(0,r.jsx)("p",{className:"jsx-80b28c207c94f510 "+((0,L.Z)(t?"bg-primary text-white send":"bg-light receive")||""),children:n.value.text})})]})}function W(e){var n=e.className,t=(0,s.RK)(z).messages,o=(0,s.RK)(b),i=(0,a.useRef)();return(0,a.useEffect)((function(){i.current.scrollTop=i.current.scrollHeight-i.current.clientHeight}),[t]),(0,r.jsxs)("ul",{ref:i,className:"jsx-d23c9c8b145fef9 "+((0,L.Z)("list-unstyled p-3 mb-0",n)||""),children:[(0,r.jsx)(l(),{id:"d23c9c8b145fef9",children:"ul.jsx-d23c9c8b145fef9{overflow-y:scroll;\noverflow-x:hidden;\npadding-bottom:4em!important}\nul.jsx-d23c9c8b145fef9::-webkit-scrollbar-track{display:none}"}),t.map((function(e,n){return(0,r.jsx)(M,{message:e,sent:o.user.id===e.value.from},n)}))]})}var J=t(634),D=t(682),X=t(8851),H=t(9384);function G(e){var n=e.src,t=e.alt;return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(l(),{id:"7b1ff92fdda61659",children:"img.jsx-7b1ff92fdda61659{width:50px;\nheight:50px;\nborder-radius:10px}"}),(0,r.jsx)("img",{src:n,alt:t,className:"jsx-7b1ff92fdda61659"})]})}function $(){return(0,r.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"20",height:"20",fill:"currentColor",viewBox:"0 0 16 16",children:(0,r.jsx)("path",{fillRule:"evenodd",d:"M11.354 1.646a.5.5 0 0 1 0 .708L5.707 8l5.647 5.646a.5.5 0 0 1-.708.708l-6-6a.5.5 0 0 1 0-.708l6-6a.5.5 0 0 1 .708 0z"})})}var q=(0,u.sj)(new function e(){var n,t,r;!function(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")}(this,e),r="search",(t="current")in(n=this)?Object.defineProperty(n,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):n[t]=r});function Q(){(0,s.RK)(b).user;var e=(0,s.RK)(z).selectedConversation,n=null===e||void 0===e?void 0:e.value.title,t=null===e||void 0===e?void 0:e.value.picture;return(0,r.jsx)(J.Z,{className:"border-bottom",children:(0,r.jsxs)(D.Z,{fluid:!0,children:[(0,r.jsx)(X.Z,{className:"d-md-none text-primary",children:(0,r.jsx)(X.Z.Link,{className:"text-primary",onClick:function(){return q.current="search"},children:(0,r.jsx)($,{})})}),(0,r.jsxs)(J.Z.Text,{className:"flex-grow-1 text-center d-flex flex-column align-items-center gap-2",children:[t&&(0,r.jsx)(G,{src:t,alt:n}),(0,r.jsx)("div",{children:n})]}),(0,r.jsx)(X.Z,{children:(0,r.jsx)(H.Z,{align:"end",children:(0,r.jsx)(H.Z.Item,{onClick:function(){return b.logout()},children:"Logout"})})})]})})}function V(e,n,t){return n in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}function Y(e){var n=e.picture,t=e.title,s=e.last,a=e.selected,o=e.onClick,i=e.typing;return(0,r.jsx)("div",{className:(0,L.Z)("list-group-item list-group-item-action bg-white border-0 py-1 px-0"),children:(0,r.jsxs)("a",{href:"#",className:(0,L.Z)("list-group-item list-group-item-action bg-gray-200 border-0 rounded-3 mx-0 d-flex gap-3 align-items-center",a&&"active"),onClick:o,children:[(0,r.jsx)("div",{children:n&&(0,r.jsx)(G,{src:n,alt:t})}),(0,r.jsxs)("div",{children:[(0,r.jsx)("h1",{className:"fs-5 mb-1",children:t}),(0,r.jsx)("p",{className:(0,L.Z)(a?"text-light":"text-black-50","fs-6 mt-0 mb-1"),children:i?(0,r.jsx)(B,{}):s})]})]})})}function ee(){return(0,r.jsx)("p",{className:"text-center m-4 text-black-50",children:"No conversations found, try searching for users nearby"})}function ne(){var e=(0,s.RK)(z),n=e.conversations,t=e.selectedConversationId,o=(0,a.useCallback)((function(e){z.selectConversation(e)}),[]);return(0,r.jsxs)("div",{children:[0===n.length&&(0,r.jsx)(ee,{}),(0,r.jsx)("ul",{className:"list-group rounded-0",children:n.map((function(e){var n=e.key,s=e.value;return(0,r.jsx)(Y,function(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{},r=Object.keys(t);"function"===typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(t).filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})))),r.forEach((function(n){V(e,n,t[n])}))}return e}({},s,{selected:s.convId===t,onClick:function(){return o(s)}}),n)}))})]})}var te=t(8232);function re(){return(0,r.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"14",height:"14",fill:"currentColor",viewBox:"0 0 16 16",children:(0,r.jsx)("path",{d:"M11.742 10.344a6.5 6.5 0 1 0-1.397 1.398h-.001c.03.04.062.078.098.115l3.85 3.85a1 1 0 0 0 1.415-1.414l-3.85-3.85a1.007 1.007 0 0 0-.115-.1zM12 6.5a5.5 5.5 0 1 1-11 0 5.5 5.5 0 0 1 11 0z"})})}function se(){return(0,r.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"14",height:"14",fill:"currentColor",viewBox:"0 0 16 16",children:(0,r.jsx)("path",{d:"M16 8A8 8 0 1 1 0 8a8 8 0 0 1 16 0zM5.354 4.646a.5.5 0 1 0-.708.708L7.293 8l-2.647 2.646a.5.5 0 0 0 .708.708L8 8.707l2.646 2.647a.5.5 0 0 0 .708-.708L8.707 8l2.647-2.646a.5.5 0 0 0-.708-.708L8 7.293 5.354 4.646z"})})}var ae=function(){};function oe(e){var n=e.value,t=e.onChange,s=void 0===t?ae:t,o=e.searching,i=e.onSearchingChange,c=void 0===i?ae:i,u=(0,a.useCallback)((function(){o||c(!0)}),[c,o]),d=(0,a.useCallback)((function(){s(""),c(!1)}),[s,c]),f=(0,a.useCallback)((function(e){s(e.target.value)}),[s]);return(0,r.jsxs)(te.Z,{children:[(0,r.jsx)(l(),{id:"b7868458d9f84d8e",children:".close.jsx-b7868458d9f84d8e{position:absolute;\nright:0.45rem;\ntop:0.25rem;\nz-index:1000}\n.search.jsx-b7868458d9f84d8e{position:absolute;\nz-index:1000;\nleft:0.45rem;\ntop:0.25rem}\n.input.jsx-b7868458d9f84d8e{padding-left:2rem}"}),(0,r.jsx)("span",{className:"jsx-b7868458d9f84d8e search text-secondary",children:(0,r.jsx)(re,{})}),(0,r.jsx)("input",{placeholder:"Search",onFocus:u,value:n,onChange:f,className:"jsx-b7868458d9f84d8e form-control rounded-3 input"}),o&&(0,r.jsx)("span",{className:"jsx-b7868458d9f84d8e close",children:(0,r.jsx)("button",{onClick:d,className:"jsx-b7868458d9f84d8e bg-white border-0 text-secondary",children:(0,r.jsx)(se,{})})})]})}function ie(e,n,t){return n in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}function ce(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{},r=Object.keys(t);"function"===typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(t).filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})))),r.forEach((function(n){ie(e,n,t[n])}))}return e}var le=function(){};function ue(e){var n=e.picture,t=e.name,s=e.onClick;return(0,r.jsxs)("a",{href:"#",className:(0,L.Z)("list-group-item list-group-item-action bg-gray-200 border-0 px-0 py-1 d-flex align-items-center gap-3"),onClick:s,children:[n&&(0,r.jsx)(G,{src:n,alt:t}),(0,r.jsx)("h1",{className:"fs-5 mb-1",children:t})]})}function de(e){var n=e.title,t=e.picture,s=e.last,a=e.selected,o=e.onClick;return(0,r.jsxs)("a",{href:"#",className:(0,L.Z)("list-group-item list-group-item-action bg-gray-200 border-0 px-0 d-flex gap-3 align-items-center",a&&"active"),onClick:o,children:[t&&(0,r.jsx)(G,{src:t,alt:n}),(0,r.jsxs)("div",{children:[(0,r.jsx)("h1",{className:"fs-5 mb-1",children:n}),(0,r.jsx)("p",{className:(0,L.Z)(a?"text-light":"text-black-50","fs-6 mt-0 mb-1"),children:s})]})]})}function fe(){return(0,r.jsx)("p",{children:"No users found, try zooming out or panning to a different area"})}function he(e){var n=e.onConversationClick,t=void 0===n?le:n,a=e.onUserClick,o=void 0===a?le:a,i=(0,s.RK)(z).conversations,c=(0,s.RK)(I),l=c.items,u=c.ready;return(0,r.jsxs)("div",{className:"p-2",children:[i.length>0&&(0,r.jsxs)("div",{className:"p-0 pt-4",children:[(0,r.jsx)("h4",{children:"Conversations"}),(0,r.jsx)("ul",{className:"list-group rounded-0",children:i.map((function(e){var n=e.key,s=e.value;return(0,r.jsx)(de,ce({},s,{onClick:function(){return t(s)}}),n)}))})]}),(0,r.jsxs)("div",{className:"p-0 pt-4",children:[(0,r.jsx)("h4",{children:"Users nearby"}),u&&(0,r.jsxs)(r.Fragment,{children:[0===l.length&&(0,r.jsx)(fe,{}),l.length>0&&(0,r.jsx)("ul",{className:"list-group",children:l.map((function(e){var n=e.key,t=e.value;return(0,r.jsx)(ue,ce({},t,{onClick:function(){return o(t)}}),n)}))})]})]})]})}var ve=(0,t(5152).default)((function(){return Promise.all([t.e(269),t.e(704)]).then(t.bind(t,2704))}),{loadableGenerated:{webpack:function(){return[2704]}},ssr:!1});function pe(){var e=(0,s.RK)(I).items,n=(0,s.RK)(b).user,t=e.filter((function(e){return e.value.lat})).map((function(e){var n=e.key,t=e.value;return{key:n,lat:t.lat,lon:t.lon,text:t.name}})),o=(0,a.useCallback)((function(e){I.setSearchBounds(e)}),[]);return n.lat?(0,r.jsx)(ve,{zoom:10,markers:t,height:200,lat:n.lat,lon:n.lon,onBoundsChange:o}):null}function me(){var e=(0,a.useState)(""),n=e[0],t=e[1],s=(0,a.useState)(!0),o=s[0],i=s[1],c=(0,a.useCallback)((function(e){t(e)}),[]),l=(0,a.useCallback)((function(e){i(e)}),[]),u=(0,a.useCallback)((function(e){z.selectConversation(e),i(!1),t("")}),[]),d=(0,a.useCallback)((function(e){z.selectUser(e),i(!1),t("")}),[]);return(0,r.jsxs)("div",{className:"p-2",children:[(0,r.jsx)(oe,{value:n,onChange:c,searching:o,onSearchingChange:l}),o&&(0,r.jsxs)("div",{className:"mt-2",children:[(0,r.jsx)(pe,{}),(0,r.jsx)(he,{onConversationClick:u,onUserClick:d})]}),!o&&(0,r.jsx)(ne,{})]})}var xe=t(1555);function ge(e){var n=e.children,t=e.className,s=e.selected;return(0,r.jsx)(xe.Z,{className:(0,L.Z)("px-0 overflow-hidden position-relative d-md-block h-100",!s&&"d-none",t),children:n})}function be(e){var n=e.children,t=e.selected;return(0,r.jsx)(xe.Z,{className:(0,L.Z)("p-0 col-md-4 border-end d-md-block",!t&&"d-none"),sm:12,children:n})}var je=t(1608),ye=t(6409);function we(e){var n=e.children;return(0,r.jsx)(ye.ZP,{children:(0,r.jsx)(D.Z,{fluid:!0,className:"h-100",children:(0,r.jsx)(je.Z,{className:"h-100",children:n})})})}function ke(){(0,a.useEffect)((function(){return z.start()}),[]);var e=(0,s.RK)(q),n=(0,s.RK)(z).selectedConversation,t=(0,a.useCallback)((function(){q.current="conversation"}),[]);return(0,a.useEffect)((function(){return d.on("conversation.selected",t),function(){d.off("conversation.selected",t)}}),[t]),(0,r.jsxs)(we,{children:[(0,r.jsx)(be,{selected:"search"===e.current,children:(0,r.jsx)(me,{})}),(0,r.jsxs)(ge,{className:"d-flex flex-column",selected:"search"!==e.current,children:[(0,r.jsx)(Q,{}),(0,r.jsx)(W,{className:"flex-grow-1"}),(0,r.jsx)(F,{typing:null===n||void 0===n?void 0:n.value.typing})]})]})}var Ce=t(5005);function Ne(e,n,t){return n in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}function Ie(){var e,n=(0,a.useState)(""),t=n[0],o=n[1],i=(0,a.useState)(""),c=i[0],l=i[1],u=(0,a.useState)(""),d=u[0],f=u[1],h=(0,a.useState)(!1),v=h[0],p=h[1],m=(0,s.RK)(b);return(0,r.jsx)("div",{className:"d-flex vh-100 align-items-center",children:(0,r.jsxs)("div",{className:"d-flex vw-100 flex-column align-items-center gap-5",children:[(0,r.jsx)("h1",{children:"Welcome to CloudChat"}),(0,r.jsxs)("form",{children:[m.error&&(0,r.jsx)("div",{className:"alert alert-primary",role:"alert",children:m.error}),v&&(0,r.jsxs)("div",{className:"mb-3",children:[(0,r.jsx)("label",{htmlFor:"name",className:"form-label",children:"Full name"}),(0,r.jsx)("input",{id:"name",type:"text",name:"name",className:"form-control",value:d,onChange:function(e){return f(e.target.value)}})]}),(0,r.jsxs)("div",{className:"mb-3",children:[(0,r.jsx)("label",{htmlFor:"username",className:"form-label",children:"Username"}),(0,r.jsx)("input",{id:"username",type:"text",name:"username",className:"form-control",value:t,onChange:function(e){return o(e.target.value)}})]}),(0,r.jsxs)("div",{className:"mb-3",children:[(0,r.jsx)("label",{htmlFor:"password",className:"form-label",children:"Password"}),(0,r.jsx)("input",(e={type:"password",className:"form-control",id:"exampleInputPassword1"},Ne(e,"type","password"),Ne(e,"name","password"),Ne(e,"value",c),Ne(e,"onChange",(function(e){return l(e.target.value)})),e))]}),!v&&(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)("div",{children:(0,r.jsx)(Ce.Z,{onClick:function(){return b.login({username:t,password:c})},children:"Sign in"})}),(0,r.jsx)("div",{children:(0,r.jsx)("button",{type:"button",className:"btn btn-link mt-3 ps-0",onClick:function(){return p(!0)},children:"No account yet? Click here to register"})})]}),v&&(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)("div",{children:(0,r.jsx)(Ce.Z,{onClick:function(){return b.register({username:t,name:d,password:c})},children:"Register"})}),(0,r.jsx)("div",{children:(0,r.jsx)("button",{type:"button",className:"btn btn-link mt-3 ps-0",onClick:function(){return p(!1)},children:"Already have an account? Click here to sign in"})})]})]}),(0,r.jsx)("p",{children:"Powered by Serverless \u26a1\ufe0f Cloud"})]})})}function Pe(e){var n=e.message;return(0,r.jsx)("div",{className:"alert alert-primary",role:"alert",children:n})}function Te(){var e=(0,s.RK)(b);return(0,r.jsxs)(r.Fragment,{children:[e.systemWarning&&(0,r.jsx)(Pe,{message:e.systemWarning}),e.isAuthenticated?(0,r.jsx)(ke,{}):(0,r.jsx)(Ie,{})]})}}},function(e){e.O(0,[774,662,338,888,179],(function(){return n=8581,e(e.s=n);var n}));var n=e.O();_N_E=n}]);