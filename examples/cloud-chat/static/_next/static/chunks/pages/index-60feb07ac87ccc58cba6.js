(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[405],{5305:function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return fe}});var r=n(5893),s=n(6277),i=n(7294),a=n(809),o=n.n(a),c=n(2447),l=n(5988),u=n(4121),d=n(9999),h=n(4047),f=n(2700),p=n(6265),v=n(5874),x=new(n(1413).y),m=n(9499),g=n(1904),j=n(6486),b=function(){function e(){(0,h.Z)(this,e),(0,p.Z)(this,"items",[]),(0,p.Z)(this,"bounds",void 0),(0,p.Z)(this,"center",void 0),(0,p.Z)(this,"radius",void 0),(0,p.Z)(this,"ready",!1),(0,p.Z)(this,"userCache",new Map),(0,p.Z)(this,"fetch",(0,j.throttle)(this.fetchInternal,1e3))}return(0,f.Z)(e,[{key:"setSearchBounds",value:function(e){this.bounds=e,this.fetch()}},{key:"setSearchRadius",value:function(e,t){this.center=e,this.radius=t,this.bounds=void 0,this.fetch()}},{key:"fetchInternal",value:function(){var e=(0,c.Z)(o().mark((function e(){var t,n,r,s,i,a;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,g.Z.getToken();case 2:return n=e.sent,r=new URL("".concat(m.YA,"/users")),null!==(t=this.bounds)&&void 0!==t&&t.sw&&(r.searchParams.append("sw.lat",this.bounds.sw.lat),r.searchParams.append("sw.lon",this.bounds.sw.lon),r.searchParams.append("ne.lat",this.bounds.ne.lat),r.searchParams.append("ne.lon",this.bounds.ne.lon)),this.center&&(r.searchParams.append("center.lat",this.center.lat),r.searchParams.append("center.lon",this.center.lon),r.searchParams.append("radius",this.radius)),e.next=8,fetch(r,{headers:{Authorization:"Bearer ".concat(n)}});case 8:return s=e.sent,e.next=11,s.json();case 11:i=e.sent,a=i.items,this.items=(a||[]).filter((function(e){return e.value.id!==g.Z.user.id})),this.ready=!0;case 15:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"getUser",value:function(){var e=(0,c.Z)(o().mark((function e(t){var n,r,s;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.userCache.get(t)){e.next=11;break}return e.next=3,g.Z.getToken();case 3:return n=e.sent,e.next=6,fetch("".concat(m.YA,"/users/").concat(t),{headers:{Authorization:"Bearer ".concat(n)}});case 6:return r=e.sent,e.next=9,r.json();case 9:s=e.sent,this.userCache.set(t,s);case 11:return e.abrupt("return",this.userCache.get(t));case 12:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()}]),e}(),y=(0,v.sj)(new b),w=function(){function e(){(0,h.Z)(this,e),(0,p.Z)(this,"messages",[]),(0,p.Z)(this,"conversations",[]),(0,p.Z)(this,"typing",!1),(0,p.Z)(this,"message",""),(0,p.Z)(this,"selectedConversation",void 0),(0,p.Z)(this,"selectedConversationId",void 0),(0,p.Z)(this,"selectedUserId",void 0),(0,p.Z)(this,"typingConversationId",void 0),(0,p.Z)(this,"typingTimeout",void 0)}return(0,f.Z)(e,[{key:"selectConversation",value:function(e){var t=e.convId;t!==this.selectedConversationId&&(this.messages=[],this.selectedConversationId=t,this.selectedConversation=this.conversations.find((function(e){return e.value.convId===t})),this.selectedUserId=void 0,this.selectedUserName=void 0,this.conversations=this.conversations.filter((function(e){return"new-conversation"!==e.value.convId})),this.fetch()),x.emit("conversation.selected",[this.selectedConversationId])}},{key:"findUserConversation",value:function(){var e=(0,c.Z)(o().mark((function e(t){return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.conversations.find((function(e){var n;return null===(n=e.value.userIds)||void 0===n?void 0:n.includes(t)})));case 1:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"selectUser",value:function(){var e=(0,c.Z)(o().mark((function e(t){var n,r,s,i;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.id,r=t.name,e.next=3,this.findUserConversation(n);case 3:if(!(s=e.sent)){e.next=7;break}return this.selectConversation(s.value),e.abrupt("return");case 7:this.selectedConversationId="new-conversation",this.selectedConversation={key:"new-conversation",value:{title:r,convId:"new-conversation",last:"New conversation"}},this.selectedUserId=n,this.selectedUserName=r,this.messages=[],i=this.conversations.filter((function(e){return"new-conversation"!==e.value.convId})),this.conversations=[this.selectedConversation].concat((0,d.Z)(i)),x.emit("conversation.selected",[this.selectedConversationId]);case 15:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"start",value:function(){var e=this;return this.interval||(this.interval=setInterval(this.fetch.bind(this),5e3),this.fetch()),function(){e.stop()}}},{key:"stop",value:function(){this.interval&&(clearInterval(this.interval),this.interval=void 0)}},{key:"updateTyping",value:function(){var e=(0,c.Z)(o().mark((function e(){return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.typingTimeout&&clearTimeout(this.typingTimeout),!this.typingConversationId||this.typingConversationId===this.selectedConversationId){e.next=5;break}return e.next=4,this.putTypingState(this.typingConversationId,!1);case 4:this.typingConversationId=void 0;case 5:if(!this.selectedConversationId||"new-conversation"===this.selectedConversationId||this.typingConversationId){e.next=9;break}return this.typingConversationId=this.selectedConversationId,e.next=9,this.putTypingState(this.typingConversationId,!0);case 9:this.typingTimeout=setTimeout(this.clearTyping.bind(this),5e3);case 10:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"clearTyping",value:function(){var e=(0,c.Z)(o().mark((function e(){return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.putTypingState(this.typingConversationId,!1);case 2:this.typingConversationId=void 0;case 3:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"putTypingState",value:function(){var e=(0,c.Z)(o().mark((function e(t,n){var r;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,g.Z.getToken();case 2:return r=e.sent,e.next=5,fetch("".concat(m.YA,"/typing"),{method:"PUT",headers:{Authorization:"Bearer ".concat(r),"Content-Type":"application/json"},body:JSON.stringify({convId:t,typing:n})});case 5:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"getConversations",value:function(){var e=(0,c.Z)(o().mark((function e(){var t,n;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,g.Z.getToken();case 2:return t=e.sent,e.next=5,fetch("".concat(m.YA,"/conversations"),{headers:{Authorization:"Bearer ".concat(t)}});case 5:return n=e.sent,e.abrupt("return",n.json());case 7:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}()},{key:"getMessages",value:function(){var e=(0,c.Z)(o().mark((function e(t){var n,r,s;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t&&"new-conversation"!==t){e.next=2;break}return e.abrupt("return",{items:[]});case 2:return e.next=4,g.Z.getToken();case 4:return n=e.sent,(r=new URL("".concat(m.YA,"/messages"))).searchParams.append("convId",t),e.next=9,fetch(r,{headers:{Authorization:"Bearer ".concat(n)}});case 9:return s=e.sent,e.abrupt("return",s.json());case 11:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()},{key:"fetch",value:function(){var e=(0,c.Z)(o().mark((function e(){var t,n,r,s,i,a=this;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return(t=this.selectedConversationId)||(this.messages=[]),e.next=4,Promise.all([this.getMessages(t),this.getConversations()]);case 4:if(n=e.sent,r=(0,u.Z)(n,2),s=r[0],i=r[1],this.messages=s.items,this.conversations=i.items,this.selectedConversation=this.selectedConversationId&&this.conversations.find((function(e){return e.value.convId===a.selectedConversationId})),this.selectedUserId&&(this.selectedConversationId="new-conversation",this.selectedConversation={key:"new-conversation",value:{title:this.selectedUserName,convId:"new-conversation",last:"New conversation"}},this.conversations=[this.selectedConversation].concat((0,d.Z)(this.conversations))),this.selectedUserId||this.selectedConversationId||!this.conversations[0]){e.next=16;break}return this.selectedConversationId=this.conversations[0].value.convId,e.next=16,this.fetch();case 16:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"createConversation",value:function(){var e=(0,c.Z)(o().mark((function e(){var t,n,r,s;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,g.Z.getToken();case 2:return t=e.sent,e.next=5,fetch("".concat(m.YA,"/conversations"),{method:"POST",headers:{Authorization:"Bearer ".concat(t),"Content-Type":"application/json"},body:JSON.stringify({userIds:[this.selectedUserId,g.Z.user.id]})});case 5:return n=e.sent,e.next=8,n.json();case 8:return r=e.sent,s=r.convId,e.abrupt("return",s);case 11:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"send",value:function(){var e=(0,c.Z)(o().mark((function e(){var t,n;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.message){e.next=2;break}return e.abrupt("return");case 2:if(t=this.message,this.message="","new-conversation"!==this.selectedConversationId){e.next=8;break}return e.next=7,this.createConversation();case 7:this.selectedConversationId=e.sent;case 8:return e.next=10,g.Z.getToken();case 10:return n=e.sent,e.next=13,fetch("".concat(m.YA,"/messages"),{method:"POST",headers:{Authorization:"Bearer ".concat(n),"Content-Type":"application/json"},body:JSON.stringify({convId:this.selectedConversationId,text:t})});case 13:return this.selectedUserId=void 0,e.next=16,Promise.all([this.fetch(),this.clearTyping()]);case 16:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"getUsers",value:function(){var e=(0,c.Z)(o().mark((function e(t){return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Promise.all(t.map((function(e){return y.getUser(e)})));case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()}]),e}(),k=(0,v.sj)(new w);function C(){return(0,r.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"6",viewBox:"0 0 24 6",children:(0,r.jsxs)("g",{className:"jsx-728468970",children:[(0,r.jsx)(l.default,{id:"728468970",children:[".dot.jsx-728468970{fill:rgba(0,0,0,0.7);-webkit-transform-origin:50% 50%;-ms-transform-origin:50% 50%;transform-origin:50% 50%;-webkit-animation:ball-beat-jsx-728468970 1.1s 0s infinite cubic-bezier(0.445,0.05,0.55,0.95);animation:ball-beat-jsx-728468970 1.1s 0s infinite cubic-bezier(0.445,0.05,0.55,0.95);}",".dot.jsx-728468970:nth-child(2){-webkit-animation-delay:0.3s !important;animation-delay:0.3s !important;}",".dot.jsx-728468970:nth-child(3){-webkit-animation-delay:0.6s !important;animation-delay:0.6s !important;}","@-webkit-keyframes ball-beat-jsx-728468970{0%{opacity:0.7;}33.33%{opacity:0.55;}66.67%{opacity:0.4;}100%{opacity:1;}}","@keyframes ball-beat-jsx-728468970{0%{opacity:0.7;}33.33%{opacity:0.55;}66.67%{opacity:0.4;}100%{opacity:1;}}"]}),(0,r.jsx)("circle",{cx:"3",cy:"3",r:"3",className:"jsx-728468970 dot"}),(0,r.jsx)("circle",{cx:"12",cy:"3",r:"3",className:"jsx-728468970 dot"}),(0,r.jsx)("circle",{cx:"21",cy:"3",r:"3",className:"jsx-728468970 dot"})]})})}function Z(){return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(l.default,{id:"2229286083",children:["p.jsx-2229286083{max-width:66%;word-wrap:break-word;line-height:24px;position:relative;padding:10px 20px;border-radius:25px;margin:5px;}",'p.jsx-2229286083:before{width:20px;content:"";position:absolute;bottom:0;height:25px;}','p.jsx-2229286083:after{width:26px;content:"";position:absolute;bottom:0;height:25px;}',".receive.jsx-2229286083:before{left:-7px;border-bottom-right-radius:16px 14px;background-color:#f8f9fa;}",".receive.jsx-2229286083:after{left:-26px;background-color:#fff;border-bottom-right-radius:10px;}"]}),(0,r.jsx)("li",{className:"jsx-2229286083 d-flex align-items-center mb-2",children:(0,r.jsx)("p",{className:"jsx-2229286083 bg-light receive",children:(0,r.jsx)(C,{})})})]})}function N(e){var t=e.typing,n=(0,s.RK)(k).message,a=(0,i.useRef)(),u=(0,i.useCallback)((function(e){(0,c.Z)(o().mark((function t(){return o().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:e.preventDefault(),e.stopPropagation(),k.send();case 3:case"end":return t.stop()}}),t)})))()}),[]),d=(0,i.useCallback)((function(){setTimeout((function(){return a.current.focus()}),100)}),[]),h=(0,i.useCallback)((function(e){k.message=e.target.value,k.updateTyping()}),[]);return(0,i.useEffect)((function(){return x.on("conversation.selected",d),function(){x.off("conversation.selected",d)}}),[d]),(0,r.jsxs)("form",{onSubmit:u,className:"jsx-1609445409 position-absolute bottom-0 w-100",children:[(0,r.jsx)(l.default,{id:"1609445409",children:["*.jsx-1609445409{background-color:rgba(255,255,255,0.6);}"]}),(0,r.jsxs)("div",{className:"jsx-1609445409 p-2",children:[t&&(0,r.jsx)(Z,{}),(0,r.jsx)("input",{ref:a,type:"text",value:n,placeholder:"Message",onChange:h,className:"jsx-1609445409 text-muted rounded-pill form-control"})]})]})}var I=n(6010);function O(e){var t=e.message,n=e.sent;return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(l.default,{id:"3677243528",children:["p.jsx-3677243528{max-width:66%;word-wrap:break-word;line-height:24px;position:relative;padding:10px 20px;border-radius:25px;margin:5px;}",'p.jsx-3677243528:before{width:20px;content:"";position:absolute;bottom:0;height:25px;}','p.jsx-3677243528:after{width:26px;content:"";position:absolute;bottom:0;height:25px;}',".send.jsx-3677243528:before{right:-7px;border-bottom-left-radius:16px 14px;background-color:#0d6efd;}",".send.jsx-3677243528:after{right:-26px;border-bottom-left-radius:10px;background-color:#fff;}",".receive.jsx-3677243528:before{left:-7px;border-bottom-right-radius:16px 14px;background-color:#f8f9fa;}",".receive.jsx-3677243528:after{left:-26px;background-color:#fff;border-bottom-right-radius:10px;}"]}),(0,r.jsx)("li",{className:"jsx-3677243528 "+((0,I.Z)("d-flex align-items-center overflow-hidden",n&&"flex-row-reverse")||""),children:(0,r.jsx)("p",{className:"jsx-3677243528 "+((0,I.Z)(n?"bg-primary text-white send":"bg-light receive")||""),children:t.value.text})})]})}function P(e){var t=e.className,n=(0,s.RK)(k).messages,a=(0,s.RK)(g.Z),o=(0,i.useRef)();return(0,i.useEffect)((function(){o.current.scrollTop=o.current.scrollHeight-o.current.clientHeight}),[n]),(0,r.jsxs)("ul",{ref:o,className:"jsx-363670536 "+((0,I.Z)("list-unstyled p-3 mb-0",t)||""),children:[(0,r.jsx)(l.default,{id:"363670536",children:["ul.jsx-363670536{overflow-y:scroll;overflow-x:hidden;padding-bottom:4em !important;}","ul.jsx-363670536::-webkit-scrollbar-track{display:none;}"]}),n.map((function(e,t){return(0,r.jsx)(O,{message:e,sent:a.user.id===e.value.from},t)}))]})}var T=n(5049),S=n(682),U=n(4209),R=n(9300);function z(e){var t=e.src,n=e.alt;return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(l.default,{id:"2171769601",children:["img.jsx-2171769601{width:50px;height:50px;border-radius:10px;}"]}),(0,r.jsx)("img",{src:t,alt:n,className:"jsx-2171769601"})]})}function A(){return(0,r.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"20",height:"20",fill:"currentColor",viewBox:"0 0 16 16",children:(0,r.jsx)("path",{fillRule:"evenodd",d:"M11.354 1.646a.5.5 0 0 1 0 .708L5.707 8l5.647 5.646a.5.5 0 0 1-.708.708l-6-6a.5.5 0 0 1 0-.708l6-6a.5.5 0 0 1 .708 0z"})})}var B=(0,v.sj)(new function e(){(0,h.Z)(this,e),(0,p.Z)(this,"current","search")});function K(){(0,s.RK)(g.Z).user;var e=(0,s.RK)(k).selectedConversation,t=null===e||void 0===e?void 0:e.value.title,n=null===e||void 0===e?void 0:e.value.picture;return(0,r.jsx)(T.Z,{className:"border-bottom",children:(0,r.jsxs)(S.Z,{fluid:!0,children:[(0,r.jsx)(U.Z,{className:"d-md-none text-primary",children:(0,r.jsx)(U.Z.Link,{className:"text-primary",onClick:function(){return B.current="search"},children:(0,r.jsx)(A,{})})}),(0,r.jsxs)(T.Z.Text,{className:"flex-grow-1 text-center d-flex flex-column align-items-center gap-2",children:[n&&(0,r.jsx)(z,{src:n,alt:t}),(0,r.jsx)("div",{children:t})]}),(0,r.jsx)(U.Z,{children:(0,r.jsx)(R.Z,{align:"end",children:(0,r.jsx)(R.Z.Item,{onClick:function(){return g.Z.logout()},children:"Logout"})})})]})})}function E(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function _(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?E(Object(n),!0).forEach((function(t){(0,p.Z)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):E(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function L(e){var t=e.picture,n=e.title,s=e.last,i=e.selected,a=e.onClick,o=e.typing;return(0,r.jsx)("div",{className:(0,I.Z)("list-group-item list-group-item-action bg-white border-0 py-1 px-0"),children:(0,r.jsxs)("a",{href:"#",className:(0,I.Z)("list-group-item list-group-item-action bg-gray-200 border-0 rounded-3 mx-0 d-flex gap-3 align-items-center",i&&"active"),onClick:a,children:[(0,r.jsx)("div",{children:t&&(0,r.jsx)(z,{src:t,alt:n})}),(0,r.jsxs)("div",{children:[(0,r.jsx)("h1",{className:"fs-5 mb-1",children:n}),(0,r.jsx)("p",{className:(0,I.Z)(i?"text-light":"text-black-50","fs-6 mt-0 mb-1"),children:o?(0,r.jsx)(C,{}):s})]})]})})}function M(){return(0,r.jsx)("p",{className:"text-center m-4 text-black-50",children:"No conversations found, try searching for users nearby"})}function D(){var e=(0,s.RK)(k),t=e.conversations,n=e.selectedConversationId,a=(0,i.useCallback)((function(e){k.selectConversation(e)}),[]);return(0,r.jsxs)("div",{children:[0===t.length&&(0,r.jsx)(M,{}),(0,r.jsx)("ul",{className:"list-group rounded-0",children:t.map((function(e){var t=e.key,s=e.value;return(0,r.jsx)(L,_(_({},s),{},{selected:s.convId===n,onClick:function(){return a(s)}}),t)}))})]})}var Y=n(3839);function F(){return(0,r.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"14",height:"14",fill:"currentColor",viewBox:"0 0 16 16",children:(0,r.jsx)("path",{d:"M11.742 10.344a6.5 6.5 0 1 0-1.397 1.398h-.001c.03.04.062.078.098.115l3.85 3.85a1 1 0 0 0 1.415-1.414l-3.85-3.85a1.007 1.007 0 0 0-.115-.1zM12 6.5a5.5 5.5 0 1 1-11 0 5.5 5.5 0 0 1 11 0z"})})}function J(){return(0,r.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"14",height:"14",fill:"currentColor",viewBox:"0 0 16 16",children:(0,r.jsx)("path",{d:"M16 8A8 8 0 1 1 0 8a8 8 0 0 1 16 0zM5.354 4.646a.5.5 0 1 0-.708.708L7.293 8l-2.647 2.646a.5.5 0 0 0 .708.708L8 8.707l2.646 2.647a.5.5 0 0 0 .708-.708L8.707 8l2.647-2.646a.5.5 0 0 0-.708-.708L8 7.293 5.354 4.646z"})})}var H=function(){};function X(e){var t=e.value,n=e.onChange,s=void 0===n?H:n,a=e.searching,o=e.onSearchingChange,c=void 0===o?H:o,u=(0,i.useCallback)((function(){a||c(!0)}),[c,a]),d=(0,i.useCallback)((function(){s(""),c(!1)}),[s,c]),h=(0,i.useCallback)((function(e){s(e.target.value)}),[s]);return(0,r.jsxs)(Y.Z,{children:[(0,r.jsx)(l.default,{id:"1210274151",children:[".close.jsx-1210274151{position:absolute;right:0.45rem;top:0.25rem;z-index:1000;}",".search.jsx-1210274151{position:absolute;z-index:1000;left:0.45rem;top:0.25rem;}",".input.jsx-1210274151{padding-left:2rem;}"]}),(0,r.jsx)("span",{className:"jsx-1210274151 search text-secondary",children:(0,r.jsx)(F,{})}),(0,r.jsx)("input",{placeholder:"Search",onFocus:u,value:t,onChange:h,className:"jsx-1210274151 form-control rounded-3 input"}),a&&(0,r.jsx)("span",{className:"jsx-1210274151 close",children:(0,r.jsx)("button",{onClick:d,className:"jsx-1210274151 bg-white border-0 text-secondary",children:(0,r.jsx)(J,{})})})]})}function G(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function W(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?G(Object(n),!0).forEach((function(t){(0,p.Z)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):G(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var q=function(){};function Q(e){var t=e.picture,n=e.name,s=e.onClick;return(0,r.jsxs)("a",{href:"#",className:(0,I.Z)("list-group-item list-group-item-action bg-gray-200 border-0 px-0 py-1 d-flex align-items-center gap-3"),onClick:s,children:[t&&(0,r.jsx)(z,{src:t,alt:n}),(0,r.jsx)("h1",{className:"fs-5 mb-1",children:n})]})}function V(e){var t=e.title,n=e.picture,s=e.last,i=e.selected,a=e.onClick;return(0,r.jsxs)("a",{href:"#",className:(0,I.Z)("list-group-item list-group-item-action bg-gray-200 border-0 px-0 d-flex gap-3 align-items-center",i&&"active"),onClick:a,children:[n&&(0,r.jsx)(z,{src:n,alt:t}),(0,r.jsxs)("div",{children:[(0,r.jsx)("h1",{className:"fs-5 mb-1",children:t}),(0,r.jsx)("p",{className:(0,I.Z)(i?"text-light":"text-black-50","fs-6 mt-0 mb-1"),children:s})]})]})}function $(){return(0,r.jsx)("p",{children:"No users found, try zooming out or panning to a different area"})}function ee(e){var t=e.onConversationClick,n=void 0===t?q:t,i=e.onUserClick,a=void 0===i?q:i,o=(0,s.RK)(k).conversations,c=(0,s.RK)(y),l=c.items,u=c.ready;return(0,r.jsxs)("div",{className:"p-2",children:[o.length>0&&(0,r.jsxs)("div",{className:"p-0 pt-4",children:[(0,r.jsx)("h4",{children:"Conversations"}),(0,r.jsx)("ul",{className:"list-group rounded-0",children:o.map((function(e){var t=e.key,s=e.value;return(0,r.jsx)(V,W(W({},s),{},{onClick:function(){return n(s)}}),t)}))})]}),(0,r.jsxs)("div",{className:"p-0 pt-4",children:[(0,r.jsx)("h4",{children:"Users nearby"}),u&&(0,r.jsxs)(r.Fragment,{children:[0===l.length&&(0,r.jsx)($,{}),l.length>0&&(0,r.jsx)("ul",{className:"list-group",children:l.map((function(e){var t=e.key,n=e.value;return(0,r.jsx)(Q,W(W({},n),{},{onClick:function(){return a(n)}}),t)}))})]})]})]})}var te=(0,n(5152).default)((function(){return Promise.all([n.e(269),n.e(148)]).then(n.bind(n,4148))}),{ssr:!1,loadableGenerated:{webpack:function(){return[4148]},modules:["../components/UserMap.js -> @components/Map"]}});function ne(){var e=(0,s.RK)(y).items,t=(0,s.RK)(g.Z).user,n=e.filter((function(e){return e.value.lat})).map((function(e){var t=e.key,n=e.value;return{key:t,lat:n.lat,lon:n.lon,text:n.name}})),a=(0,i.useCallback)((function(e){y.setSearchBounds(e)}),[]);return t.lat?(0,r.jsx)(te,{zoom:10,markers:n,height:200,lat:t.lat,lon:t.lon,onBoundsChange:a}):null}function re(){var e=(0,i.useState)(""),t=e[0],n=e[1],s=(0,i.useState)(!0),a=s[0],o=s[1],c=(0,i.useCallback)((function(e){n(e)}),[]),l=(0,i.useCallback)((function(e){o(e)}),[]),u=(0,i.useCallback)((function(e){k.selectConversation(e),o(!1),n("")}),[]),d=(0,i.useCallback)((function(e){k.selectUser(e),o(!1),n("")}),[]);return(0,r.jsxs)("div",{className:"p-2",children:[(0,r.jsx)(X,{value:t,onChange:c,searching:a,onSearchingChange:l}),a&&(0,r.jsxs)("div",{className:"mt-2",children:[(0,r.jsx)(ne,{}),(0,r.jsx)(ee,{onConversationClick:u,onUserClick:d})]}),!a&&(0,r.jsx)(D,{})]})}var se=n(1555);function ie(e){var t=e.children,n=e.className,s=e.selected;return(0,r.jsx)(se.Z,{className:(0,I.Z)("px-0 overflow-hidden position-relative d-md-block h-100",!s&&"d-none",n),children:t})}function ae(e){var t=e.children,n=e.selected;return(0,r.jsx)(se.Z,{className:(0,I.Z)("p-0 col-md-4 border-end d-md-block",!n&&"d-none"),sm:12,children:t})}var oe=n(4051),ce=n(6409);function le(e){var t=e.children;return(0,r.jsx)(ce.ZP,{children:(0,r.jsx)(S.Z,{fluid:!0,className:"h-100",children:(0,r.jsx)(oe.Z,{className:"h-100",children:t})})})}function ue(){(0,i.useEffect)((function(){return k.start()}),[]);var e=(0,s.RK)(B),t=(0,s.RK)(k).selectedConversation,n=(0,i.useCallback)((function(){B.current="conversation"}),[]);return(0,i.useEffect)((function(){return x.on("conversation.selected",n),function(){x.off("conversation.selected",n)}}),[n]),(0,r.jsxs)(le,{children:[(0,r.jsx)(ae,{selected:"search"===e.current,children:(0,r.jsx)(re,{})}),(0,r.jsxs)(ie,{className:"d-flex flex-column",selected:"search"!==e.current,children:[(0,r.jsx)(K,{}),(0,r.jsx)(P,{className:"flex-grow-1"}),(0,r.jsx)(N,{typing:null===t||void 0===t?void 0:t.value.typing})]})]})}var de=n(5005);function he(){var e=(0,s.RK)(g.Z);return e.isLoading?null:e.error?(0,r.jsxs)("div",{children:[(0,r.jsxs)("p",{children:["Oops... ",e.error.message]}),(0,r.jsx)(de.Z,{onClick:function(){return g.Z.logout({returnTo:window.location.origin})},children:"Log out"})]}):(0,r.jsx)("div",{className:"d-flex vh-100 align-items-center",children:(0,r.jsxs)("div",{className:"d-flex vw-100 flex-column align-items-center gap-5",children:[(0,r.jsx)("h1",{children:"Welcome to CloudChat"}),(0,r.jsx)(de.Z,{onClick:function(){return g.Z.login()},children:"Sign in with Auth0"}),(0,r.jsx)("p",{children:"Powered by Serverless \u26a1\ufe0f Cloud"})]})})}function fe(){return(0,s.RK)(g.Z).isAuthenticated?(0,r.jsx)(ue,{}):(0,r.jsx)(he,{})}},8581:function(e,t,n){(window.__NEXT_P=window.__NEXT_P||[]).push(["/",function(){return n(5305)}])}},function(e){e.O(0,[774,662,528,888,179],(function(){return t=8581,e(e.s=t);var t}));var t=e.O();_N_E=t}]);